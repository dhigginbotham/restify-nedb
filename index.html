<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Restify NeDB by dhigginbotham</title>
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="javascripts/respond.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!--[if lt IE 8]>
    <link rel="stylesheet" href="stylesheets/ie.css">
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

  </head>
  <body>
      <div id="header">
        <nav>
          <li class="fork"><a href="https://github.com/dhigginbotham/restify-nedb">View On GitHub</a></li>
          <li class="downloads"><a href="https://github.com/dhigginbotham/restify-nedb/zipball/master">ZIP</a></li>
          <li class="downloads"><a href="https://github.com/dhigginbotham/restify-nedb/tarball/master">TAR</a></li>
          <li class="title">DOWNLOADS</li>
        </nav>
      </div><!-- end header -->

    <div class="wrapper">

      <section>
        <div id="title">
          <h1>Restify NeDB</h1>
          <p>Express module that adds a REST API for NeDB</p>
          <hr>
          <span class="credits left">Project maintained by <a href="https://github.com/dhigginbotham">dhigginbotham</a></span>
          <span class="credits right">Hosted on GitHub Pages &mdash; Theme by <a href="https://twitter.com/michigangraham">mattgraham</a></span>
        </div>

        <h1>
<a name="restify-nedb-for-nedb-" class="anchor" href="#restify-nedb-for-nedb-"><span class="octicon octicon-link"></span></a>restify-nedb (for <a href="https://github.com/louischatriot/nedb">nedb</a>) <img src="https://drone.io/github.com/dhigginbotham/restify-nedb/status.png" align="right">
</h1>

<p><code>restify-nedb</code> was built to give you restful api resources for client side application frameworks like <code>angular.js</code>, <code>ember.js</code>, <code>backbone.js</code> or <code>knockout.js</code> as well as give you a simple file/memory based cache utilizing <a href="https://github.com/louischatriot/nedb">nedb</a>. (ps, i love <a href="https://github.com/louischatriot/nedb">nedb</a>, you should too.) If you haven't already checked it out, maybe you want to use it separate of all of this extra stuff, do it. It's like sqlite, with a subset of mongodb's api. <em>Really neat.</em></p>

<h3>
<a name="features" class="anchor" href="#features"><span class="octicon octicon-link"></span></a>Features</h3>

<ul>
<li>Super fast <code>nedb</code> file/memory backed cache w/ simple garbage collection</li>
<li>100% coffeescript, hate it or love it </li>
<li>restful routing: <code>GET</code>, <code>POST</code>, <code>PUT</code>, <code>DELETE</code> </li>
<li>parses <code>json/multi-part</code>
</li>
<li>Let me know if you have any issues, please open issues/prs etc, it's a lot more fun that way</li>
</ul><hr><p><img src="https://nodei.co/npm/restify-nedb.png?downloads=true&amp;stars=true"></p>

<h3>
<a name="installation" class="anchor" href="#installation"><span class="octicon octicon-link"></span></a>Installation</h3>

<pre><code>npm install restify-nedb --save
</code></pre>

<h3>
<a name="example" class="anchor" href="#example"><span class="octicon octicon-link"></span></a>Example</h3>

<div class="highlight"><pre><span class="kd">var</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'express'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
<span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'http'</span><span class="p">).</span><span class="nx">createServer</span><span class="p">(</span><span class="nx">app</span><span class="p">);</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'port'</span><span class="p">,</span> <span class="mi">1337</span><span class="p">);</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">compress</span><span class="p">());</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">methodOverride</span><span class="p">());</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">bodyParser</span><span class="p">());</span>

<span class="kd">var</span> <span class="nx">restify</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'restify-nedb'</span><span class="p">).</span><span class="nx">mount</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">config</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'restify-nedb'</span><span class="p">).</span><span class="nx">config</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'path'</span><span class="p">);</span>

<span class="c1">// some sample middlware to throw at it</span>
<span class="kd">var</span> <span class="nx">sampleMiddleware</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'here\'s a sample middleware...'</span><span class="p">);</span>
  <span class="k">return</span> <span class="nx">next</span><span class="p">();</span>
<span class="p">};</span>

<span class="c1">// default config options</span>
<span class="kd">var</span> <span class="nx">opts</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">filePath</span><span class="o">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span><span class="s1">'db'</span><span class="p">,</span><span class="s1">'filestore.db'</span><span class="p">),</span>
  <span class="nx">maxAge</span><span class="o">:</span> <span class="mi">1000</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span><span class="p">,</span>
  <span class="nx">prefix</span><span class="o">:</span> <span class="s1">'/session'</span><span class="p">,</span>
  <span class="nx">middleware</span><span class="o">:</span> <span class="p">[</span><span class="nx">sampleMiddleware</span><span class="p">]</span>
<span class="p">};</span>

<span class="c1">// initialize our config object</span>

<span class="nx">cfg</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">config</span><span class="p">(</span><span class="nx">opts</span><span class="p">);</span>

<span class="c1">// if you aren't already using an nedb</span>
<span class="c1">// instance, then calling this will create</span>
<span class="c1">// one for you.</span>

<span class="c1">// accepts sync/blocking</span>

<span class="c1">// cfg.makeDataStore();</span>

<span class="c1">// api = new restify(cfg, app);</span>

<span class="c1">// or async &lt;3</span>

<span class="nx">cfg</span><span class="p">.</span><span class="nx">makeDataStore</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">ds_cfg</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">api</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">restify</span><span class="p">(</span><span class="nx">ds_cfg</span><span class="p">,</span> <span class="nx">app</span><span class="p">);</span>
  <span class="p">};</span>
<span class="p">});</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'port'</span><span class="p">),</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'restify-nedb example listening on %s'</span><span class="p">,</span> <span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'port'</span><span class="p">));</span>
<span class="p">});</span>
</pre></div>

<h2>
<a name="configuration-options" class="anchor" href="#configuration-options"><span class="octicon octicon-link"></span></a>Configuration Options</h2>

<table>
<thead><tr>
<th>Options</th>
<th>Defaults</th>
<th>Type</th>
<th>Infos</th>
</tr></thead>
<tbody>
<tr>
<td><strong>ds</strong></td>
<td><code>internal</code></td>
<td>DataStore</td>
<td>allow for outside nedb processes to be restified. tip: <code>config.ds()</code> returns a new DataStore with whatever your <code>opts</code> are set to, once it's fired it will internalize and share</td>
</tr>
<tr>
<td><strong>prefix</strong></td>
<td><code>/ds</code></td>
<td>String</td>
<td>defines the first route path, for instance <code>http://localhost:3000/ds</code>
</td>
</tr>
<tr>
<td><strong>version</strong></td>
<td><code>/v1</code></td>
<td>String</td>
<td>not preferred, as a rule i feel these aren't the best idea for your api, last thing you want is fragmentation in your api</td>
</tr>
<tr>
<td><strong>exclude</strong></td>
<td><code>[]</code></td>
<td>Array</td>
<td>excludes keys/values from the api, good for things like <code>password</code>
</td>
</tr>
<tr>
<td><strong>middleware</strong></td>
<td><code>[]</code></td>
<td>Array</td>
<td>middlewares, ie passport authentication, logging, analytics</td>
</tr>
<tr>
<td><strong>memoryStore</strong></td>
<td><code>false</code></td>
<td>Boolean</td>
<td>whether or not keep an in-memory store or a file based persistant store, defaults to <code>false</code>, we like persistant files.</td>
</tr>
<tr>
<td><strong>fileName</strong></td>
<td><code>nedb-filestore.db</code></td>
<td>String</td>
<td>file name for your nedb filestore</td>
</tr>
<tr>
<td><strong>filePath</strong></td>
<td><code>../db</code></td>
<td>String</td>
<td>bit easier to change the path and view the contents instead of digging through <code>node_modules</code>
</td>
</tr>
<tr>
<td><strong>maxAge</strong></td>
<td><code>1000 * 60 * 60</code></td>
<td>Number</td>
<td>if set to <code>null</code> or <code>false</code> automated gc will be disabled</td>
</tr>
<tr>
<td><strong>store</strong></td>
<td><code>undefined</code></td>
<td>String</td>
<td>
<code>not currently working</code> - will allow for multiple nedb collections, still working out the kinks.</td>
</tr>
</tbody>
</table><h2>
<a name="routes" class="anchor" href="#routes"><span class="octicon octicon-link"></span></a>Routes</h2>

<h3>
<a name="configmakedatastoreerr-callback" class="anchor" href="#configmakedatastoreerr-callback"><span class="octicon octicon-link"></span></a><code>config.makeDataStore(err?, callback?)</code>
</h3>

<ul>
<li>accepts either sync/async flow, if you don't have an <code>nedb</code> instance going, use this to create one -- otherwise pass it into your options object.</li>
</ul><h2>
<a name="ordering" class="anchor" href="#ordering"><span class="octicon octicon-link"></span></a>Ordering</h2>

<h3>
<a name="limit20" class="anchor" href="#limit20"><span class="octicon octicon-link"></span></a><code>?limit=20</code>
</h3>

<div class="highlight"><pre><span class="n">GET</span> <span class="n">http</span><span class="p">:</span><span class="c1">//localhost:3000/session/v1?limit=20</span>
</pre></div>

<ul>
<li>
<code>if (limit=20)</code> then it will only return 20 objects, etc.</li>
</ul><h3>
<a name="skip10" class="anchor" href="#skip10"><span class="octicon octicon-link"></span></a><code>?skip=10</code>
</h3>

<div class="highlight"><pre><span class="n">GET</span> <span class="n">http</span><span class="p">:</span><span class="c1">//localhost:3000/session/v1?skip=10</span>
</pre></div>

<ul>
<li>skip fields, good for paging</li>
</ul><h3>
<a name="sortval" class="anchor" href="#sortval"><span class="octicon octicon-link"></span></a><code>?sort=val</code>
</h3>

<div class="highlight"><pre><span class="n">GET</span> <span class="n">http</span><span class="p">:</span><span class="c1">//localhost:3000/session/v1?sort=val</span>
</pre></div>

<ul>
<li>sort doc in ascending</li>
</ul><h3>
<a name="sort-val" class="anchor" href="#sort-val"><span class="octicon octicon-link"></span></a><code>?sort=-val</code>
</h3>

<div class="highlight"><pre><span class="n">GET</span> <span class="n">http</span><span class="p">:</span><span class="c1">//localhost:3000/session/v1?sort=-val</span>
</pre></div>

<ul>
<li>sort doc in descending order</li>
</ul><hr><h2>
<a name="query--searching" class="anchor" href="#query--searching"><span class="octicon octicon-link"></span></a>Query / Searching</h2>

<h3>
<a name="keyvalue" class="anchor" href="#keyvalue"><span class="octicon octicon-link"></span></a><code>?key=value</code>
</h3>

<div class="highlight"><pre><span class="n">GET</span> <span class="n">http</span><span class="p">:</span><span class="c1">//localhost:3000/session/v1?key=value</span>
</pre></div>

<ul>
<li>queries matching key/values</li>
</ul><h2>
<a name="defaults" class="anchor" href="#defaults"><span class="octicon octicon-link"></span></a>Defaults</h2>

<div class="highlight"><pre><span class="n">GET</span> <span class="n">http</span><span class="p">:</span><span class="c1">//localhost:3000/session/v1</span>
<span class="n">POST</span> <span class="n">http</span><span class="p">:</span><span class="c1">//localhost:3000/session/v1</span>

<span class="n">GET</span> <span class="n">http</span><span class="p">:</span><span class="c1">//localhost:3000/session/v1/:id</span>
<span class="n">PUT</span> <span class="n">http</span><span class="p">:</span><span class="c1">//localhost:3000/session/v1/:id</span>
<span class="n">DELETE</span> <span class="n">http</span><span class="p">:</span><span class="c1">//localhost:3000/session/v1/:id</span>

<span class="n">GET</span> <span class="n">http</span><span class="p">:</span><span class="c1">//localhost:3000/session/v1?id=:id</span>
<span class="n">PUT</span> <span class="n">http</span><span class="p">:</span><span class="c1">//localhost:3000/session/v1?id=:id</span>
</pre></div>

<h2>
<a name="additional" class="anchor" href="#additional"><span class="octicon octicon-link"></span></a>Additional</h2>

<h3>
<a name="appendtrue" class="anchor" href="#appendtrue"><span class="octicon octicon-link"></span></a><code>?append=true</code>
</h3>

<div class="highlight"><pre><span class="n">PUT</span> <span class="n">http</span><span class="p">:</span><span class="c1">//localhost:3000/session/v1/:id?append=true</span>
</pre></div>

<ul>
<li>append defaults to false. Set to true to do something similar to <code>findAndUpdate</code>
</li>
</ul><h3>
<a name="_stale-override" class="anchor" href="#_stale-override"><span class="octicon octicon-link"></span></a><code>_stale</code> override</h3>

<div class="highlight"><pre><span class="n">POST</span> <span class="p">/</span> <span class="n">PUT</span> <span class="n">http</span><span class="p">:</span><span class="c1">//localhost:3000/session/v1</span>
</pre></div>

<ul>
<li>passing <code>_stale</code> in your body/json will act as an override to <code>stale</code>, say you need some things to last longer/shorter than other cached items</li>
</ul><h2>
<a name="tests" class="anchor" href="#tests"><span class="octicon octicon-link"></span></a>Tests</h2>

<div class="highlight"><pre><span class="n">npm</span> <span class="n">test</span>
</pre></div>

<h2>
<a name="cake-tools" class="anchor" href="#cake-tools"><span class="octicon octicon-link"></span></a>Cake tools</h2>

<ul>
<li>
<code>cake build:docs</code> will build annotated source code documentation from docco</li>
<li>
<code>cake build:coffee</code> will compile coffee from <code>/src</code> to js in <code>/lib</code>
</li>
</ul><h2>
<a name="pro-tips" class="anchor" href="#pro-tips"><span class="octicon octicon-link"></span></a>Pro-tips</h2>

<ul>
<li>I would recommend using something like <a href="https://chrome.google.com/webstore/detail/advanced-rest-client/hgmloofddffdnphfgcellkdfbfbjeloo?hl=en-US">Advanced REST Client</a> for testing, it'll help.</li>
</ul><h2>
<a name="license" class="anchor" href="#license"><span class="octicon octicon-link"></span></a>License</h2>

<div class="highlight"><pre><span class="n">The</span> <span class="n">MIT</span> <span class="n">License</span> <span class="p">(</span><span class="n">MIT</span><span class="p">)</span>

<span class="n">Copyright</span> <span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="mi">2013</span> <span class="n">David</span> <span class="n">Higginbotham</span> 

<span class="n">Permission</span> <span class="k">is</span> <span class="n">hereby</span> <span class="n">granted</span><span class="p">,</span> <span class="n">free</span> <span class="n">of</span> <span class="n">charge</span><span class="p">,</span> <span class="n">to</span> <span class="n">any</span> <span class="n">person</span> <span class="n">obtaining</span> <span class="n">a</span> <span class="n">copy</span>
<span class="n">of</span> <span class="k">this</span> <span class="n">software</span> <span class="n">and</span> <span class="n">associated</span> <span class="n">documentation</span> <span class="n">files</span> <span class="p">(</span><span class="n">the</span> <span class="s">"Software"</span><span class="p">),</span> <span class="n">to</span> <span class="n">deal</span>
<span class="k">in</span> <span class="n">the</span> <span class="n">Software</span> <span class="n">without</span> <span class="n">restriction</span><span class="p">,</span> <span class="n">including</span> <span class="n">without</span> <span class="n">limitation</span> <span class="n">the</span> <span class="n">rights</span>
<span class="n">to</span> <span class="n">use</span><span class="p">,</span> <span class="n">copy</span><span class="p">,</span> <span class="n">modify</span><span class="p">,</span> <span class="n">merge</span><span class="p">,</span> <span class="n">publish</span><span class="p">,</span> <span class="n">distribute</span><span class="p">,</span> <span class="n">sublicense</span><span class="p">,</span> <span class="n">and</span><span class="p">/</span><span class="n">or</span> <span class="n">sell</span>
<span class="n">copies</span> <span class="n">of</span> <span class="n">the</span> <span class="n">Software</span><span class="p">,</span> <span class="n">and</span> <span class="n">to</span> <span class="n">permit</span> <span class="n">persons</span> <span class="n">to</span> <span class="n">whom</span> <span class="n">the</span> <span class="n">Software</span> <span class="k">is</span>
<span class="n">furnished</span> <span class="n">to</span> <span class="k">do</span> <span class="n">so</span><span class="p">,</span> <span class="n">subject</span> <span class="n">to</span> <span class="n">the</span> <span class="n">following</span> <span class="n">conditions</span><span class="p">:</span>

<span class="n">The</span> <span class="n">above</span> <span class="n">copyright</span> <span class="n">notice</span> <span class="n">and</span> <span class="k">this</span> <span class="n">permission</span> <span class="n">notice</span> <span class="n">shall</span> <span class="n">be</span> <span class="n">included</span> <span class="k">in</span>
<span class="n">all</span> <span class="n">copies</span> <span class="n">or</span> <span class="n">substantial</span> <span class="n">portions</span> <span class="n">of</span> <span class="n">the</span> <span class="n">Software</span><span class="p">.</span>

<span class="n">THE</span> <span class="n">SOFTWARE</span> <span class="n">IS</span> <span class="n">PROVIDED</span> <span class="s">"AS IS"</span><span class="p">,</span> <span class="n">WITHOUT</span> <span class="n">WARRANTY</span> <span class="n">OF</span> <span class="n">ANY</span> <span class="n">KIND</span><span class="p">,</span> <span class="n">EXPRESS</span> <span class="n">OR</span>
<span class="n">IMPLIED</span><span class="p">,</span> <span class="n">INCLUDING</span> <span class="n">BUT</span> <span class="n">NOT</span> <span class="n">LIMITED</span> <span class="n">TO</span> <span class="n">THE</span> <span class="n">WARRANTIES</span> <span class="n">OF</span> <span class="n">MERCHANTABILITY</span><span class="p">,</span>
<span class="n">FITNESS</span> <span class="n">FOR</span> <span class="n">A</span> <span class="n">PARTICULAR</span> <span class="n">PURPOSE</span> <span class="n">AND</span> <span class="n">NONINFRINGEMENT</span><span class="p">.</span> <span class="n">IN</span> <span class="n">NO</span> <span class="n">EVENT</span> <span class="n">SHALL</span> <span class="n">THE</span>
<span class="n">AUTHORS</span> <span class="n">OR</span> <span class="n">COPYRIGHT</span> <span class="n">HOLDERS</span> <span class="n">BE</span> <span class="n">LIABLE</span> <span class="n">FOR</span> <span class="n">ANY</span> <span class="n">CLAIM</span><span class="p">,</span> <span class="n">DAMAGES</span> <span class="n">OR</span> <span class="n">OTHER</span>
<span class="n">LIABILITY</span><span class="p">,</span> <span class="n">WHETHER</span> <span class="n">IN</span> <span class="n">AN</span> <span class="n">ACTION</span> <span class="n">OF</span> <span class="n">CONTRACT</span><span class="p">,</span> <span class="n">TORT</span> <span class="n">OR</span> <span class="n">OTHERWISE</span><span class="p">,</span> <span class="n">ARISING</span> <span class="n">FROM</span><span class="p">,</span>
<span class="n">OUT</span> <span class="n">OF</span> <span class="n">OR</span> <span class="n">IN</span> <span class="n">CONNECTION</span> <span class="n">WITH</span> <span class="n">THE</span> <span class="n">SOFTWARE</span> <span class="n">OR</span> <span class="n">THE</span> <span class="n">USE</span> <span class="n">OR</span> <span class="n">OTHER</span> <span class="n">DEALINGS</span> <span class="n">IN</span>
<span class="n">THE</span> <span class="n">SOFTWARE</span><span class="p">.</span>
</pre></div>
      </section>

    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    
  </body>
</html>